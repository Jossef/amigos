<ion-view view-title="{{vm.event.name}}">

    <ion-nav-bar class="bar-positive" animation="nav-title-slide-ios7">

        <ion-nav-buttons side="left">
            <button class="button button-icon" ui-sref="events"><i class="icon ion-android-arrow-back"></i></button>

        </ion-nav-buttons>
        <ion-nav-buttons side="right">
            <button class="button button-icon"
                    ng-click="vm.popover.show($event)"
                    ng-init="isEditable=false"
                    ng-click="isEditable = !isEditable"><i class="ion-edit"></i></button>
        </ion-nav-buttons>
    </ion-nav-bar>


    <ion-tabs class="tabs-positive tabs-icon-only">

        <ion-tab title="Info" icon="ion-happy-outline">

            <ion-view>
                <ion-content padding="false">


                    <div class="event-image">
                        <img src="http://lorempixel.com/800/380/">

                        <div class="title-wrapper">
                            <h3 class="title">{{vm.event.name}}</h3>

                        </div>
                    </div>

                    <div class="item">
                        <!--TODO: ON CLICK, OPEN THE DATES EXPAND IF DATE HAVEN'T CHOSEN? -->
                        <!--TODO: ON CLICK, DB UPDATE: APPROVED/IF MORE THEN ONE DATE CHOSEN - SOLVE -->
                        <button ng-click="isDateListShowen=true"
                                class="button button-block button-positive button-rect"> Join!
                        </button>
                    </div>

                    <div menu-close class="item item-divider" ng-init="isDateListShowen=false"
                         ng-switch="vm.event.dates.length"
                         ng-class="{active: isDateListShowen}"
                         ng-click="(vm.event.dates.length > 1) && (isDateListShowen = !isDateListShowen)">
                        <i class="icon" ng-show="vm.event.dates.length > 1" ng-class="isDateListShowen ? 'ion-minus' : 'ion-plus'"></i>
                        &nbsp;

                        <!--TODO: DISPLAY DATE IF CHOSEN, ELSE DISPLAY AN "HAVEN'T CHOSEN YET" MESSAGE -->
                        <!--TODO: CLICK ON MESSAGE IS EXPANDING INSTEAD PLUS -->

                        Date:
                        <span ng-switch-when="1">  {{ vm.event.dates[0] | date }} </span>
                        <span ng-switch-default> Click to vote! </span>

                    </div>

                    <div class="item item-icon-left item-icon-right"
                         ng-repeat="date in vm.event.dates"
                         ng-show="isDateListShowen">
                        <i class="icon ion-android-calendar" ng-click="vm.showOnCalendar(date)"></i>



                        {{date | date}} {{osnat}}
                        <i class="icon">
                            <label class="toggle toggle-positive">
                                <input type="checkbox" ng-model="osnat">
                                <div class="track">
                                    <div class="handle"></div>
                                </div>
                            </label>
                        </i>


                    </div>






                    <div menu-close class="item item-divider"ng-init="isLocationListShowen=false"
                         ng-class="{active: isLocationListShowen}"
                         ng-click="isLocationListShowen = !isLocationListShowen">
                        <i class="icon" ng-class="isLocationListShowen ? 'ion-minus' : 'ion-plus'"></i>
                        &nbsp;
                        Location: {{vm.event.location.address}}
                    </div>

                    <div class="item" ng-if="isLocationListShowen">

                        <ui-gmap-google-map options="vm.mapOptions" center="vm.mapCenter" zoom="vm.mapZoom">
                            <ui-gmap-marker coords="vm.mapMarker.location" idkey="0"></ui-gmap-marker>
                        </ui-gmap-google-map>


                        <!--TODO: MOVE OUT OF LOCATION DIV -->
                        <button ng-click="vm.navigate()"
                                class="button button-block button-positive button-rect"><i class="icon ion-navigate"></i> Take me there!
                        </button>

                    </div>

                    <div menu-close class="item item-divider" ng-init="isWhoListShowen=false"
                         ng-class="{active: isWhoListShowen}"
                         ng-click="isWhoListShowen = !isWhoListShowen"
                         ng-switch="vm.event.participants.length">
                        <i class="icon" ng-class="isWhoListShowen ? 'ion-minus' : 'ion-plus'"></i>
                        &nbsp;

                        <!--TODO: DISPLAY NUMBER OF JOINED FRIENDS, ELSE DISPLAY AN "HAVEN'T JOINED YET" MESSAGE -->
                        <!--TODO: CLICK ON NUMBER\ICON IS EXPANDING INSTEAD PLUS -->
                        <span ng-switch-when="0"> There are no participants yet </span>
                        <span ng-switch-when="1">  1 participant </span>
                        <span ng-switch-default> {{vm.event.participants.length}} participants! </span>

                    </div>


                    <!--TODO: ADD CLICK TO CALL ICON -->
                    <div class="item item-button-right" ng-repeat="participant in vm.event.participants"
                         ng-show="isWhoListShowen">

                        {{participant.user.nickname}}

                        <button class="button button-positive">
                            <i class="ion-ios-telephone" ></i>
                        </button>

                    </div>

                    <div menu-close class="item item-divider" ng-init="isCartListShowen=false"
                         ng-show="vm.event.products.length"
                         ng-class="{active: isCartListShowen}"
                         ng-click="isCartListShowen = !isCartListShowen">
                        <i class="icon" ng-class="isCartListShowen  ? 'ion-minus' : 'ion-plus'"></i>
                        &nbsp;

                        <!--TODO: DISPLAY MESSAGE: "ALL PRODUCTS HAVE VOLUNTEERS!", ELSE DISPLAY AN "THERE ARE STILL PRODUCTS YOU CAN BRING!" MESSAGE -->
                        <!--TODO: CLICK ON NUMBER\ICON IS EXPANDING INSTEAD PLUS -->
                        Cart
                    </div>


                    <!--TODO: ADD CLICK TO CALL ICON -->
                    <div class="item item-button-right"
                         ng-repeat="product in vm.event.products" ng-show="isCartListShowen">

                        {{product.name}}

                        <button class="button button-positive">
                            <i class="ion-ios-telephone" ></i>
                        </button>

                    </div>

                </ion-content>
            </ion-view>

        </ion-tab>

        <ion-tab title="Chat" on-select="vm.onChatSelected()" icon="ion-android-chat">

            <ion-content class="pane-chat content-stable" delegate-handle="chatScroll">

                <div class=" pane-chat-body">

                    <div class="message-list">

                        <div ng-repeat="message in vm.event.messages" class="msg msg-group">

                            <div class="message"
                                 ng-init="me = message.user.id == vm.user.id"
                                 ng-class="me ? 'message-out' : 'message-in'">

                                <div class="bubble bubble-text">

                                    <!-- TODO get random color method -->
                                    <div ng-hide="me" class="message-author">⁠⁠⁠
                                        <span class="content"> {{ message.user.name }} </span>
                                    </div>

                                    <div class="message-text">
                                        <span class="message-content" dir="auto">{{ message.message }}</span>
                                    </div>

                                </div>
                                <div class="message-meta">{{ message.timestamp | date:'h:mm a' }}</div>
                            </div>

                        </div>

                    </div>

                </div>
            </ion-content>

            <ion-footer-bar keyboard-attach class="bar-stable item-input-inset">
                <label class="item-input-wrapper">
                    <input type="text" placeholder="Type your message"
                           ng-enter="vm.sendMessage(chatMessage); chatMessage = ''; closeKeyboard()"
                           ng-model="chatMessage"
                           on-focus="inputUp()"
                           on-blur="inputDown()"/>

                </label>
                <button class="button button-clear" ng-click="vm.sendMessage(chatMessage); chatMessage = '';">
                    Send
                </button>
            </ion-footer-bar>

        </ion-tab>

        <ion-tab title="Settings" icon-on="ion-ios-gear" icon-off="ion-ios-gear-outline">

            <ion-view>
                <ion-content padding="false">
                    <div class="list">

                        <ion-toggle ng-model="vm.approved" toggle-class="toggle-positive">Are you going?</ion-toggle>


                    </div>


                </ion-content>
            </ion-view>
        </ion-tab>

    </ion-tabs>
</ion-view>
